/*
 * Device tree for Telechips TCC899x family SoC
 *
 * Copyright (C) 2018 Telechips Inc. - http://www.telechips.com
 *
 * This file is dual-licensed: you can use it either under the terms
 * of the GPL or the X11 license, at your option. Note that this dual
 * licensing only applies to this file, and not this project as a
 * whole.
 *
 *  a) This file is free software; you can redistribute it and/or
 *     modify it under the terms of the GNU General Public License as
 *     published by the Free Software Foundation; either version 2 of the
 *     License, or (at your option) any later version.
 *
 *     This file is distributed in the hope that it will be useful,
 *     but WITHOUT ANY WARRANTY; without even the implied warranty of
 *     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *     GNU General Public License for more details.
 *
 * Or, alternatively,
 *
 *  b) Permission is hereby granted, free of charge, to any person
 *     obtaining a copy of this software and associated documentation
 *     files (the "Software"), to deal in the Software without
 *     restriction, including without limitation the rights to use,
 *     copy, modify, merge, publish, distribute, sublicense, and/or
 *     sell copies of the Software, and to permit persons to whom the
 *     Software is furnished to do so, subject to the following
 *     conditions:
 *
 *     The above copyright notice and this permission notice shall be
 *     included in all copies or substantial portions of the Software.
 *
 *     THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 *     EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 *     OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 *     NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 *     HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 *     WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 *     FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 *     OTHER DEALINGS IN THE SOFTWARE.
 */
#include <generated/autoconf.h>

#undef SZ_1MB
#define SZ_1MB                          (1024*1024)
#define ARRAY_16MBYTE(x)                ((((x) + ((16*SZ_1MB)-1))>> 24) << 24)
#define ARRAY_MBYTE(x)                  ((((x) + (SZ_1MB-1))>> 20) << 20)
#define ARRAY_256KBYTE(x)               ((((x) + ((SZ_1MB/4)-1))>> 18) << 18)

//for HEVC/VPU framebuffer_size Calculation
#define WAVE_CAL_PROCBUFFER(use,w,h,f) (((0x1400000 /*the rest except framebuffer, userdatabuffer and workbuffer*/) + (ARRAY_MBYTE(((w*h*2370)/1000)*(f+7+3))))*use)
#define VPU_CAL_PROCBUFFER(use,w,h,f)  (((0x400000 /*the rest except framebuffer and workbuffer*/) + ARRAY_MBYTE(((w*h*182)/100)*(f+7)))*use)
#define VPU_CAL_ENC_PROCBUFFER(use,w,h,f) (((0x300000 /*the rest except framebuffer and workbuffer*/) + ARRAY_MBYTE(w*h*3/2) + ARRAY_MBYTE((((w+15)/16*16)*((h+15)/16*16)*3/2)*f))*use)
//##################################################################################################################################################
/********************* Need to be optimized by customer ******************/
//##################################################################################################################################################

// Caution!! Contact engineer who is in charge of scurity in Telechips
// if you modified anything in this file with enabled CONFIG_ARM_TRUSTZONE Feature.

//#define SUPPORT_ROTATION  // Enable in case supporting the display-device or video-contents rotation (90/180/270) // have to have rotation h/w block

//***************************** DISPLAY ******************************/
#if defined(CONFIG_LCD_HDMI4K)
#define PRIMARY_FRAMEBUFFER_WIDTH               3840
#define PRIMARY_FRAMEBUFFER_HEIGHT              2160
#else
#define PRIMARY_FRAMEBUFFER_WIDTH               1920
#define PRIMARY_FRAMEBUFFER_HEIGHT              1080
#endif
#define SECONDARY_FRAMEBUFFER_WIDTH             0
#define SECONDARY_FRAMEBUFFER_HEIGHT            0
#define TERTIARY_FRAMEBUFFER_WIDTH              0
#define TERTIARY_FRAMEBUFFER_HEIGHT             0

//Choose more bigger resolution between Primary and Secondary display device.
//and Should sync with hardware/telechips/common/hwcomposer/Hwrenderer.h
#define PRIMARY_TARGET_WIDTH                    3840
#define PRIMARY_TARGET_HEIGHT                   2160
#define SECONDARY_TARGET_WIDTH                  720
#define SECONDARY_TARGET_HEIGHT                 480
#define TERTIARY_TARGET_WIDTH                   0
#define TERTIARY_TARGET_HEIGHT                  0

#if ((PRIMARY_TARGET_WIDTH*PRIMARY_TARGET_HEIGHT) > (SECONDARY_TARGET_WIDTH*SECONDARY_TARGET_HEIGHT))
#define SUPPORT_DISPLAY_MAX_WIDTH       PRIMARY_TARGET_WIDTH
#define SUPPORT_DISPLAY_MAX_HEIGHT      PRIMARY_TARGET_HEIGHT
#else
#define SUPPORT_DISPLAY_MAX_WIDTH       SECONDARY_TARGET_WIDTH
#define SUPPORT_DISPLAY_MAX_HEIGHT      SECONDARY_TARGET_HEIGHT
#endif

#if defined(CONFIG_TCC_VIDEO_S_FEATURE)
#define SUPPORT_VIDEO_PIP
#endif
#ifdef SUPPORT_VIDEO_PIP
#define SUPPORT_PIP_MAX_WIDTH   1920
#define SUPPORT_PIP_MAX_HEIGHT  1080
#endif

//****************************** Camera ******************************/
#define CAMERA_INPUT_WIDTH                      0
#define CAMERA_INPUT_HEIGHT                     0
#if defined(CONFIG_TCC_VIDEO_S_FEATURE)
#define SUPPORT_CAMERA_CAPTURE          0
#endif

//***************************** VPU/HEVC ******************************/
//Should sync with hardware/telechips/omx/omx_videodec_interface/include/vdec.h
#if defined(CONFIG_VDEC_MAX_FRAME_SIZE_1)
#    define SUPPORT_VIDEO_MAX_WIDTH         4096
#    define SUPPORT_VIDEO_MAX_HEIGHT        2160
#elif defined(CONFIG_VDEC_MAX_FRAME_SIZE_2)
#    define SUPPORT_VIDEO_MAX_WIDTH         3840
#    define SUPPORT_VIDEO_MAX_HEIGHT        2160
#endif

#define SUPPORT_VIQE_MAX_WIDTH          1920
#define SUPPORT_VIQE_MAX_HEIGHT         1088

// DECODER on VPU
#define INST_1ST_USE                    (1)
#define INST_1ST_IS_HEVC_TYPE           (1)                             // please check "CONFIG_SUPPORT_TCC_HEVC" Feature in order to enable HEVC
#define INST_1ST_VIDEO_WIDTH            (SUPPORT_VIDEO_MAX_WIDTH)       // HEVC: 32x alignment, Other: 16x alignment
#define INST_1ST_VIDEO_HEIGHT           (SUPPORT_VIDEO_MAX_HEIGHT)      // HEVC: 32x alignment, Other: 16x alignment
#define INST_1ST_MAX_FRAMEBUFFERS       (8)                             // HEVC: 1~21, Others: 1~24

#if defined(CONFIG_VIOC_DOLBY_VISION_CERTIFICATION_TEST)
#define INST_2ND_USE                    (1)
#define INST_2ND_IS_HEVC_TYPE           (1)     // please check "CONFIG_SUPPORT_TCC_HEVC" Feature in order to enable HEVC
#define INST_2ND_VIDEO_WIDTH            (1920)  // HEVC: 32x alignment, Other: 16x alignment
#define INST_2ND_VIDEO_HEIGHT           (1088)  // HEVC: 32x alignment, Other: 16x alignment
#define INST_2ND_MAX_FRAMEBUFFERS       (24)    // HEVC: 1~21, Others: 1~24
#else
#define INST_2ND_USE                    (0)
#define INST_2ND_IS_HEVC_TYPE           (0)     // please check "CONFIG_SUPPORT_TCC_HEVC" Feature in order to enable HEVC
#define INST_2ND_VIDEO_WIDTH            (720)  // HEVC: 32x alignment, Other: 16x alignment
#define INST_2ND_VIDEO_HEIGHT           (576)  // HEVC: 32x alignment, Other: 16x alignment
#define INST_2ND_MAX_FRAMEBUFFERS       (24)    // HEVC: 1~21, Others: 1~24
#endif

#define INST_3RD_USE                    (0)
#define INST_3RD_IS_HEVC_TYPE           (0)     // please check "CONFIG_SUPPORT_TCC_HEVC" Feature in order to enable HEVC
#define INST_3RD_VIDEO_WIDTH            (720)     // HEVC: 32x alignment, Other: 16x alignment
#define INST_3RD_VIDEO_HEIGHT           (576)     // HEVC: 32x alignment, Other: 16x alignment
#define INST_3RD_MAX_FRAMEBUFFERS       (24)    // HEVC: 1~21, Others: 1~24

#define INST_4TH_USE                    (0)
#define INST_4TH_IS_HEVC_TYPE           (0)     // please check "CONFIG_SUPPORT_TCC_HEVC" Feature in order to enable HEVC
#define INST_4TH_VIDEO_WIDTH            (720)     // HEVC: 32x alignment, Other: 16x alignment
#define INST_4TH_VIDEO_HEIGHT           (576)     // HEVC: 32x alignment, Other: 16x alignment
#define INST_4TH_MAX_FRAMEBUFFERS       (24)    // HEVC: 1~21, Others: 1~24

#define INST_5TH_USE                    (0)
#define INST_5TH_IS_HEVC_TYPE           (0)     // please check "CONFIG_SUPPORT_TCC_HEVC" Feature in order to enable HEVC
#define INST_5TH_VIDEO_WIDTH            (720)     // HEVC: 32x alignment, Other: 16x alignment
#define INST_5TH_VIDEO_HEIGHT           (576)     // HEVC: 32x alignment, Other: 16x alignment
#define INST_5TH_MAX_FRAMEBUFFERS       (24)    // HEVC: 1~21, Others: 1~24


// ENCODER on VPU
#define INST_ENC_1ST_USE                (0)
#define INST_ENC_1ST_VIDEO_WIDTH        (0)
#define INST_ENC_1ST_VIDEO_HEIGHT       (0)
#define INST_ENC_1ST_MAX_FRAMEBUFFERS   (0)
#define INST_ENC_2ND_USE                (0)
#define INST_ENC_2ND_VIDEO_WIDTH        (0)
#define INST_ENC_2ND_VIDEO_HEIGHT       (0)
#define INST_ENC_2ND_MAX_FRAMEBUFFERS   (0)
#define INST_ENC_3RD_USE                (0)
#define INST_ENC_3RD_VIDEO_WIDTH        (0)
#define INST_ENC_3RD_VIDEO_HEIGHT       (0)
#define INST_ENC_3RD_MAX_FRAMEBUFFERS   (0)
#define INST_ENC_4TH_USE                (0)
#define INST_ENC_4TH_VIDEO_WIDTH        (0)
#define INST_ENC_4TH_VIDEO_HEIGHT       (0)
#define INST_ENC_4TH_MAX_FRAMEBUFFERS   (0)
#define INST_ENC_5TH_USE                (0)
#define INST_ENC_5TH_VIDEO_WIDTH        (0)
#define INST_ENC_5TH_VIDEO_HEIGHT       (0)
#define INST_ENC_5TH_MAX_FRAMEBUFFERS   (0)
#if defined(CONFIG_VENC_CNT_1) || defined(CONFIG_VENC_CNT_2) || defined(CONFIG_VENC_CNT_3) \
	|| defined(CONFIG_VENC_CNT_4) || defined(CONFIG_VENC_CNT_5)
#undef INST_ENC_1ST_USE
#undef INST_ENC_1ST_VIDEO_WIDTH
#undef INST_ENC_1ST_VIDEO_HEIGHT
#undef INST_ENC_1ST_MAX_FRAMEBUFFERS
#define INST_ENC_1ST_USE                (1)
#define INST_ENC_1ST_VIDEO_WIDTH        (1920)       // 16x alignment
#define INST_ENC_1ST_VIDEO_HEIGHT       (1088)       // 16x alignment
#define INST_ENC_1ST_MAX_FRAMEBUFFERS   (8)          // 8 :: fixed value. ask right engineer if you want to change it.
#endif

#if defined(CONFIG_VENC_CNT_2) || defined(CONFIG_VENC_CNT_3) || defined(CONFIG_VENC_CNT_4) \
	|| defined(CONFIG_VENC_CNT_5)
#undef INST_ENC_2ND_USE
#undef INST_ENC_2ND_VIDEO_WIDTH
#undef INST_ENC_2ND_VIDEO_HEIGHT
#undef INST_ENC_2ND_MAX_FRAMEBUFFERS
#define INST_ENC_2ND_USE                (1)
#define INST_ENC_2ND_VIDEO_WIDTH        (1280)       // 16x alignment
#define INST_ENC_2ND_VIDEO_HEIGHT       (720)        // 16x alignment
#define INST_ENC_2ND_MAX_FRAMEBUFFERS   (8)          // 8 :: fixed value. ask right engineer if you want to change it.
#endif

#if defined(CONFIG_VENC_CNT_3) || defined(CONFIG_VENC_CNT_4) || defined(CONFIG_VENC_CNT_5)
#undef INST_ENC_3RD_USE
#undef INST_ENC_3RD_VIDEO_WIDTH
#undef INST_ENC_3RD_VIDEO_HEIGHT
#undef INST_ENC_3RD_MAX_FRAMEBUFFERS
#define INST_ENC_3RD_USE                (1)
#define INST_ENC_3RD_VIDEO_WIDTH        (800)        // 16x alignment
#define INST_ENC_3RD_VIDEO_HEIGHT       (480)        // 16x alignment
#define INST_ENC_3RD_MAX_FRAMEBUFFERS   (8)          // 8 :: fixed value. ask right engineer if you want to change it.
#endif

#if defined(CONFIG_VENC_CNT_4) || defined(CONFIG_VENC_CNT_5)
#undef INST_ENC_4TH_USE
#undef INST_ENC_4TH_VIDEO_WIDTH
#undef INST_ENC_4TH_VIDEO_HEIGHT
#undef INST_ENC_4TH_MAX_FRAMEBUFFERS
#define INST_ENC_4TH_USE                (1)
#define INST_ENC_4TH_VIDEO_WIDTH        (640)        // 16x alignment
#define INST_ENC_4TH_VIDEO_HEIGHT       (480)        // 16x alignment
#define INST_ENC_4TH_MAX_FRAMEBUFFERS   (8)          // 8 :: fixed value. ask right engineer if you want to change it.
#endif

#if defined(CONFIG_VENC_CNT_5)
#undef INST_ENC_5TH_USE
#undef INST_ENC_5TH_VIDEO_WIDTH
#undef INST_ENC_5TH_VIDEO_HEIGHT
#undef INST_ENC_5TH_MAX_FRAMEBUFFERS
#define INST_ENC_5TH_USE                (1)
#define INST_ENC_5TH_VIDEO_WIDTH        (640)        // 16x alignment
#define INST_ENC_5TH_VIDEO_HEIGHT       (480)        // 16x alignment
#define INST_ENC_5TH_MAX_FRAMEBUFFERS   (8)          // 8 :: fixed value. ask right engineer if you want to change it.
#endif

//##################################################################################################################################################
//##################################################################################################################################################
