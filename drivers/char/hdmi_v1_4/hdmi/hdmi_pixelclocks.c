/****************************************************************************
Copyright (C) 2018 Telechips Inc.

This program is free software; you can redistribute it and/or modify it under the terms
of the GNU General Public License as published by the Free Software Foundation;
either version 2 of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE. See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place,
Suite 330, Boston, MA 02111-1307 USA

@note Tab size is 8
****************************************************************************/
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/delay.h>

#include <asm/io.h>
#include <asm/uaccess.h>
#include <hdmi_1_4_video.h>
#include <hdmi_1_4_audio.h>
#include <hdmi_1_4_hdmi.h>
#include <hdmi.h>
#include <regs-hdmi.h>

#define HDMI_PHY_REGS 32

/** Register value table for HDMI PHY on TCC897x */
static const struct hdmi_phy_configs {
        unsigned int pixel_clock;
        unsigned int bpp;
        unsigned char reg[HDMI_PHY_REGS];
} hdmi_phy_config_regs [] =
{
        /**
          * TMDS Data Amplitude[4:0] : (Reg40 Bit<3:0>, REG3C Bit<7>), TMDS Clock Amplitude[3:0] : (Reg5C Bit<7:3>), TMDS Pre-emphasis Control : (Reg40 Bit<7:4>)
	        .reg = {0x04,0x08,0x0C,0x10,0x14.0x18,0x1C,0x20,0x24,0x28,0x2C,0x30,0x34,0x38,0x3C,0x40,
	                0x44,0x48,0x4C,0x50,0x54,0x58,0x5C,0x60,0x64,0x68,0x6C,0x70,0x74,0x78,0x7C,0x80
                },
        */

        //25.000Mhz
        {
                .pixel_clock = 25000000,
                .bpp = 8,
                .reg = {0xD1,0x2A,0x72,0x40,0x3C,0xD8,0xC8,0x86,0xE8,0xFA,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xF6,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 25000000,
                .bpp = 10,
                .reg = {0xD1,0x27,0x51,0x55,0x40,0x08,0xC8,0x81,0xE8,0xEA,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xC5,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 25000000,
                .bpp = 12,
                .reg = {0xD1,0x1F,0x30,0x63,0x40,0x20,0xC8,0x81,0xE8,0xBC,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xA4,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        //  25.175Mhz
        {
                .pixel_clock = 25175000,
                .bpp = 8,
                .reg = {0xD1,0x1F,0x50,0x40,0x20,0x1E,0xC8,0x81,0xE8,0xBD,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xF4,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 25200000,
                .bpp = 10,
                .reg = {0xD1,0x27,0x51,0x55,0x40,0x2B,0xC8,0x81,0xE8,0xEC,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xC3,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 25200000,
                .bpp = 12,
                .reg = {0xD1,0x1F,0x30,0x63,0x20,0x1E,0xC8,0x81,0xE8,0xBD,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xA3,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        //  25.200Mhz
        {
                .pixel_clock = 25200000,
                .bpp = 8,
                .reg = {0x52,0x3F,0x55,0x40,0x01,0x00,0xC8,0x82,0xC8,0xBD,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x01,0x84,0x05,0x02,0x24,0x86,0x54,0xF4,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 25200000,
                .bpp = 10,
                .reg = {0x52,0x69,0x75,0x57,0x01,0x00,0xC8,0x82,0xC8,0x3B,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x01,0x84,0x05,0x02,0x24,0x86,0x54,0xC3,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 25200000,
                .bpp = 10,
                .reg = {0x52,0x3F,0x35,0x63,0x01,0x00,0xC8,0x82,0xC8,0xBD,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xA3,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },



        //  27.000Mhz
        {
                .pixel_clock = 27000000,
                .bpp = 8,
                .reg = {0xD1,0x22,0x51,0x40,0x08,0xFC,0xE0,0x98,0xE8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xE4,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 27000000,
                .bpp = 10,
                .reg = {0xD1,0x2A,0x52,0x55,0x08,0x03,0xC8,0x86,0xE8,0xFD,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xB6,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 27000000,
                .bpp = 12,
                .reg = {0xD1,0x33,0x54,0x65,0x08,0xFA,0xC8,0x85,0xE8,0x30,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x98,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        //  27.027Mhz
        {
                .pixel_clock = 27027000,
                .bpp = 8,
                .reg = {0xD1,0x2D,0x72,0x40,0x64,0x12,0xC8,0x43,0xE8,0x0E,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xE3,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 27027000,
                .bpp = 10,
                .reg = {0xD1,0x38,0x74,0x57,0x50,0x31,0xC1,0x80,0xC8,0x52,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xB6,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 27027000,
                .bpp = 12,
                .reg = {0xD4,0x87,0x31,0x63,0x64,0x1B,0xE0,0x19,0xE8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x98,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 36.000Mhz
        {
                .pixel_clock = 36000000,
                .bpp = 8,
                .reg = {0x51,0x2D,0x55,0x40,0x40,0x00,0xC8,0x02,0xC8,0x0E,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xAB,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 40.000Mhz
        {
                .pixel_clock = 40000000,
                .bpp = 8,
                .reg = {0xD1,0x21,0x31,0x40,0x3C,0x28,0xC8,0x87,0xE8,0xC8,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x9A,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 44.955Mhz
        {
                .pixel_clock = 44955000,
                .bpp = 8,
                .reg = {0xD1,0x25,0x31,0x40,0x5B,0x54,0xC8,0x83,0xE8,0xE1,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x11,0x25,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 44955000,
                .bpp = 10,
                .reg = {0xD2,0x5D,0x32,0x53,0x5B,0x3B,0xD0,0x83,0xE8,0x19,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xDB,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 44955000,
                .bpp = 12,
                .reg = {0xD2,0x70,0x35,0x63,0x5B,0x23,0xC8,0x88,0xE8,0x51,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xB6,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 45.000Mhz
        {
                .pixel_clock = 45000000,
                .bpp = 8,
                .reg = {0x52,0x4B,0x35,0x40,0x01,0x00,0xC8,0x82,0xC8,0xE1,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x11,0x25,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 45000000,
                .bpp = 10,
                .reg = {0xD1,0x2F,0x32,0x53,0x40,0xF0,0xC8,0x81,0xE8,0x19,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xDA,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 45000000,
                .bpp = 12,
                .reg = {0xD1,0x38,0x34,0x63,0x40,0x20,0xC8,0x80,0xC8,0x52,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xB6,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        //  54.000Mhz
        {
                .pixel_clock = 54000000,
                .bpp = 8,
                .reg = {0x51,0x2D,0x35,0x40,0x01,0x00,0xC8,0x82,0xC8,0x0E,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xE4,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 54000000,
                .bpp = 10,
                .reg = {0xD1,0x38,0x35,0x53,0x08,0x04,0xC8,0x88,0xE8,0x52,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xB6,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 54000000,
                .bpp = 12,
                .reg = {0xD1,0x22,0x15,0x61,0x08,0xFC,0xC8,0x82,0xC8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x98,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 54.054Mhz
        {
                .pixel_clock = 54054000,
                .bpp = 8,
                .reg = {0xD1,0x2D,0x32,0x40,0x64,0x12,0xC8,0x43,0xE8,0x0E,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xE3,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 54054000,
                .bpp = 10,
                .reg = {0xD2,0x70,0x34,0x53,0x50,0x31,0xC8,0x80,0xC8,0x52,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xB6,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 54054000,
                .bpp = 12,
                .reg = {0xD4,0x87,0x11,0x61,0x64,0x1B,0xE0,0x19,0xE8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x98,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },


        // 59.400Mhz
        {
                .pixel_clock = 59400000,
                .bpp = 8,
                .reg = {0x52,0x63,0x35,0x40,0x01,0x00,0xC8,0x82,0xC8,0x29,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xCF,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 59400000,
                .bpp = 10,
                .reg = {0xD1,0x1F,0x10,0x51,0x40,0xF8,0xC8,0x81,0xE8,0xBA,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xA5,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 59400000,
                .bpp = 12,
                .reg = {0xD1,0x25,0x11,0x61,0x40,0x10,0xC8,0x83,0xE8,0xDF,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x8A,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        //65.000Mhz
        {
                .pixel_clock = 65000000,
                .bpp = 8,
                .reg = {0xD1,0x36,0x34,0x40,0x0C,0x04,0xC8,0x82,0xE8,0x45,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xBD,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 65000000,
                .bpp = 10,
                .reg = {0xD1,0x22,0x11,0x51,0x30,0xF2,0xC8,0x86,0xE8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x97,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 65000000,
                .bpp = 12,
                .reg = {0xD1,0x29,0x12,0x61,0x40,0xD0,0xC8,0x87,0xE8,0xF4,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x7E,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        //71.000Mhz
        {
                .pixel_clock = 71000000,
                .bpp = 8,
                .reg = {0xD1,0x3B,0x35,0x40,0x0C,0x04,0xC8,0x85,0xE8,0x63,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x57,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 72.000Mhz
        {
                .pixel_clock = 72000000,
                .bpp = 8,
                .reg = {0x51,0x1E,0x15,0x40,0x01,0x00,0xC8,0x82,0xC8,0xB4,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xAB,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 72000000,
                .bpp = 10,
                .reg = {0x52,0x4B,0x15,0x51,0x01,0x00,0xC8,0x82,0xC8,0xE1,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x89,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 72000000,
                .bpp = 12,
                .reg = {0x51,0x2D,0x15,0x61,0x01,0x00,0xC8,0x82,0xC8,0x0E,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xC7,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 74.176Mhz
        {
                .pixel_clock = 74175000,
                .bpp = 8,
                .reg = {0xD1,0x1F,0x10,0x40,0x5B,0xEF,0xC8,0x81,0xE8,0xB9,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xA6,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 74175000,
                .bpp = 10,
                .reg = {0xD1,0x27,0x14,0x51,0x5B,0xA7,0xC8,0x84,0xE8,0xE8,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x85,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 74175000,
                .bpp = 12,
                .reg = {0xD2,0x5D,0x12,0x61,0x5B,0xCD,0xD0,0x43,0xE8,0x16,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xBA,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 74.250Mhz
        {
                .pixel_clock = 74250000,
                .bpp = 8,
                .reg = {0xD1,0x1F,0x10,0x40,0x40,0xF8,0xC8,0x81,0xE8,0xBA,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xA5,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 74250000,
                .bpp = 10,
                .reg = {0xD1,0x27,0x11,0x51,0x40,0xD6,0xC8,0x81,0xE8,0xE8,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x84,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 74250000,
                .bpp = 12,
                .reg = {0xD1,0x2E,0x12,0x61,0x40,0x34,0xC8,0x82,0xE8,0x16,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xB9,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 83.500Mhz
        {
                .pixel_clock = 83500000,
                .bpp = 8,
                .reg = {0xD1,0x23,0x11,0x40,0x0C,0xFB,0xC8,0x85,0xE8,0xD1,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x4A,0x24,0x00,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 97.34Mhz
        {
                .pixel_clock = 97340000,
                .bpp = 8,
                .reg = {0xD1,0x29,0x12,0x61,0x40,0xD0,0xC8,0x87,0xE8,0xF4,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x7E,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 106.500Mhz
        {
                .pixel_clock = 106500000,
                .bpp = 8,
                .reg = {0xD1,0x2C,0x12,0x40,0x0C,0x09,0xC8,0x84,0xE8,0x0A,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x73,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        //108.000Mhz
        {
                .pixel_clock = 108000000,
                .bpp = 8,
                .reg = {0x51,0x2D,0x15,0x40,0x01,0x00,0xC8,0x82,0xC8,0x0E,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xC7,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 108000000,
                .bpp = 10,
                .reg = {0xD1,0x38,0x14,0x51,0x08,0x04,0xC8,0x80,0xC8,0x52,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x6C,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 108000000,
                .bpp = 12,
                .reg = {0xD1,0x22,0x01,0x60,0x08,0xFC,0xC8,0x86,0xE8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x2F,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 108.108Mhz
        {
                .pixel_clock = 108108000,
                .bpp = 8,
                .reg = {0xD1,0x2D,0x12,0x40,0x64,0x12,0xC8,0x43,0xE8,0x0E,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0xC7,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 108108000,
                .bpp = 10,
                .reg = {0xD2,0x70,0x14,0x51,0x50,0x31,0xC8,0x80,0xC8,0x52,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x6C,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 108108000,
                .bpp = 12,
                .reg = {0xD4,0x87,0x01,0x60,0x64,0x1B,0xE0,0x19,0xE8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x2F,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 122.500Mhz
        {
                .pixel_clock = 122500000,
                .bpp = 8,
                .reg = {0xD1,0x33,0x14,0x40,0x0C,0x01,0xC8,0x85,0xE8,0x32,0xD9,0x45,0xA0,0xAC,0x30,0x08,
                        0x80,0x09,0x84,0x05,0x02,0x24,0x86,0x54,0x64,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 146.250Mhz
        {
                .pixel_clock = 146250000,
                .bpp = 8,
                .reg = {0xD1,0x3D,0x15,0x40,0x18,0xFD,0xC8,0x83,0xE8,0x6E,0xD9,0x45,0xA0,0xAC,0x30,0x0e,
                0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0x54,0x24,0x01,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 148.352Mhz
        {
                .pixel_clock = 148350000,
                .bpp = 8,
                .reg = {0xD1,0x1F,0x00,0x40,0x5B,0xEF,0xC8,0x81,0xE8,0xB9,0xD8,0x45,0xA0,0xAC,0x30,0x0e,
                       0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0x4B,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 148350000,
                .bpp = 10,
                .reg = {0xD1,0x27,0x04,0x50,0x5B,0xA7,0xC8,0x84,0xE8,0xE8,0xD8,0x45,0xA0,0xAC,0x30,0x0e,
                       0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0x09,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 148350000,
                .bpp = 12,
                .reg = {0xD2,0x5D,0x02,0x60,0x5B,0xCD,0xD0,0x43,0xE8,0x16,0xD9,0x45,0xA0,0xAC,0x30,0x0e,
                       0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0xDD,0x24,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 148.500Mhz
        {
                .pixel_clock = 148500000,
                .bpp = 8,
                .reg = {0xD1,0x1F,0x00,0x40,0x40,0xF8,0xC8,0x81,0xE8,0xBA,0xD8,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0x4B,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 148500000,
                .bpp = 10,
                .reg = {0xD1,0x27,0x01,0x50,0x40,0xD6,0xC8,0x81,0xE8,0xE8,0xD8,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0x09,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 148500000,
                .bpp = 12,
                .reg = {0xD1,0x2E,0x02,0x60,0x40,0x34,0xC8,0x82,0xE8,0x16,0xD9,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0xDD,0x24,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        // 162.000Mhz
        {
                .pixel_clock = 162000000,
                .bpp = 8,
                .reg = {0x54,0x87,0x05,0x40,0x01,0x00,0xC8,0x82,0xC8,0xCB,0xD8,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0x2F,0x25,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 162000000,
                .bpp = 10,
                .reg = {0xD1,0x2A,0x02,0x50,0x40,0x18,0xC8,0x86,0xE8,0xFD,0xD8,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0xF3,0x24,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },
        {
                .pixel_clock = 162000000,
                .bpp = 12,
                .reg = {0xD1,0x33,0x04,0x60,0x40,0xD0,0xC8,0x85,0xE8,0x30,0xD9,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0xCA,0x24,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        //297.000Mhz
        {
                .pixel_clock = 297000000,
                .bpp = 8,
                .reg = {0xD1,0x3E,0x05,0x40,0x40,0xE0,0xC8,0x42,0xE8,0x73,0xD9,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0xA5,0x24,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },

        //296.703Mhz
        {
		// (297MHz / 1.001 - 1/1.001)
		// 148.351648351648MHz x2
                .pixel_clock = 296700000,
                .bpp = 8,
                .reg = {0xD1,0x3E,0x05,0x40,0x5B,0xDE,0xC8,0x82,0xE8,0x73,0xD9,0x45,0xA0,0xAC,0x30,0x0e,
                        0x80,0x09,0x84,0x05,0x02,0x24,0xe4,0x54,0xA6,0x24,0x03,0x00,0x00,0x01,0x80,0x90
                },
        },


};

static void tcc_hdmi_phy_mode_set_done(struct tcc_hdmi_dev *dev, int done)
{
        unsigned int reg_val = 0x00;

        if(done) {
                // Enable PHY
                reg_val = 0x80;
        }

        hdmi_reg_write(dev, reg_val, HDMIDP_PHYREG(0x7C));
}

void hdmi_phy_reset(struct tcc_hdmi_dev *dev)
{
        unsigned int val;

        if(dev != NULL) {
                // HDMI PHY Reset
                val = ddi_reg_read(dev, DDICFG_HDMICTRL);

                val |= HDMICTRL_HDMI_ENABLE;
                val &= ~HDMICTRL_RESET_SPDIF;
                val &= ~HDMICTRL_RESET_TMDS;
                val |= HDMICTRL_RESET_HDMI;

                ddi_reg_write(dev, val, DDICFG_HDMICTRL);

                tcc_ddi_swreset_hdmi(dev, 1);
                udelay(1);
                tcc_ddi_swreset_hdmi(dev, 0);

                udelay(100);        // min 25us wait is needed for resetting phy.

                val = ddi_reg_read(dev, DDICFG_HDMICTRL);

                val |= HDMICTRL_HDMI_ENABLE;
                val &= ~HDMICTRL_RESET_SPDIF;
                val &= ~HDMICTRL_RESET_TMDS;
                val &= ~HDMICTRL_RESET_HDMI;

                ddi_reg_write(dev, val, DDICFG_HDMICTRL);

                val = ddi_reg_read(dev, DDICFG_HDMICTRL);
                #if defined(CONFIG_HDMI_CLK_USE_XIN_24MHZ)
                val |= (1 << 9);
                val |= (1 << 8);
                #else
                val &= ~(3 << 8);
                #endif /* CONFIG_HDMI_CLK_USE_XIN_24MHZ */

                // This option must be enable at TCC897x
                // Internal Clock Setting
                val |= (1 << 11);
                // In TCC897x HDMI Link, Encoding option is must disabled.
                val |= (0 << 14);
                ddi_reg_write(dev, val, DDICFG_HDMICTRL);

                udelay(1000);
        }
}

int tcc_hdmi_phy_power_down(struct tcc_hdmi_dev *dev)
{
        if(dev != NULL) {
                tcc_hdmi_phy_mode_set_done(dev, 0);

                //TX Power down(Reg74) Bit<6:4>,Bit<2:0> : refer LN28LPP_HDMI_v1p4_TX_PHY_DataSheet_REV1.2.pdf
                // Bit<6> : PLL PD(PLL & Bias Block Power Down)
                // Bit<5> : TX_CLKSER_PD (Clock Serializer Power Down)
                // Bit<4> : TX_CLKDRV_PD (TMDS Clock Driver Power Down)
                // Bit<2> : TX_DRV_PD (TMDS Data Driver Power Down)
                // Bit<1> : TX_SER_PD (TMDS Data Serializer Power Down)
                // Bit<0> : TX_CLK_PD (TMDS Internal Clock Buffer / Divider Power Down)
                hdmi_reg_write(dev, 0x36, HDMIDP_PHYREG(0x74));
                hdmi_reg_write(dev, 0x80, HDMIDP_PHYREG(0x7C));

                #if 0
                {
                        unsigned int reg = hdmi_reg_read(dev, HDMIDP_PHYREG(0x74));
                        printk(KERN_INFO "[INFO][HDMI_V14] Reg74  = 0x%02x \n", reg);
                }
                #endif
        }

        return 0;
}

void tcc_hdmi_phy_dump(struct tcc_hdmi_dev *dev)
{
        int phy_loop;
        unsigned int val;

        printk(KERN_INFO "[INFO][HDMI_V14]HDMI PHY DUMP\r\n");
        for(phy_loop = 0; phy_loop < HDMI_PHY_REGS; phy_loop++) {
                val = hdmi_reg_read(dev, HDMIDP_PHYREG((phy_loop+1) << 2));
                printk(KERN_INFO "[INFO][HDMI_V14] 0x%02x ", val);
                if((phy_loop+1)%16 == 0) printk(KERN_INFO "[INFO][HDMI_V14] \r\n");
        }

        printk(KERN_INFO "[INFO][HDMI_V14] \r\n\r\n");
}

int tcc_hdmi_phy_config_by_rawdata(struct tcc_hdmi_dev *dev, unsigned char* phy_regs, unsigned int len)
{
        int ret = 0;
        int phy_loop;
        if(phy_regs == NULL) {
                printk(KERN_ERR "[ERROR][HDMI_V14]%s phy_regs is NULL\r\n", __func__);
                ret = -1;
                goto end_process;
        }

        tcc_hdmi_phy_mode_set_done(dev, 0);


        for(phy_loop = 0; phy_loop < len; phy_loop++) {
                if(((phy_loop+1) << 2) == 0x7C) {
                        /* Skip mode set done */
                        continue;
                }
                hdmi_reg_write(dev, phy_regs[phy_loop], HDMIDP_PHYREG((phy_loop+1) << 2));
        }

        hdmi_reg_write(dev, 0x90, HDMIDP_PHYREG(0x8C));

        tcc_hdmi_phy_mode_set_done(dev, 1);

        tcc_hdmi_phy_dump(dev);

        ret = 0;

end_process:
        return ret;
}



int tcc_hdmi_phy_config(struct tcc_hdmi_dev *dev, unsigned int pixel_clock, unsigned int bpp)
{
        int ret = 0;
        int phy_loop, phylist_max, phy_status;
        unsigned char *phy_regs = NULL;

        phylist_max = sizeof(hdmi_phy_config_regs)/sizeof(struct hdmi_phy_configs);

        for(phy_loop=0; phy_loop <  phylist_max; phy_loop++){
                if(pixel_clock == hdmi_phy_config_regs[phy_loop].pixel_clock &&
                   bpp == (unsigned int)hdmi_phy_config_regs[phy_loop].bpp) {
                        phy_regs = (unsigned char *)hdmi_phy_config_regs[phy_loop].reg;
                        break;
                };
        }

        if(phy_regs == NULL) {
                printk(KERN_ERR "[ERROR][HDMI_V14]%s with %dHz %d pixel is failed\r\n", __func__, pixel_clock, bpp);
                ret = -1;
                goto end_process;
        }

	printk(KERN_INFO "[INFO][HDMI_V14]%s with %dHz %d bpp\r\n", __func__, pixel_clock, bpp);
	phy_status = hdmi_reg_read(dev, HDMI_SS_PHY_STATUS_0) & 0xFF;
	if(!phy_status) {
		hdmi_phy_reset(dev);
	}

        tcc_hdmi_phy_mode_set_done(dev, 0);

        for(phy_loop = 0; phy_loop < HDMI_PHY_REGS; phy_loop++) {
                if(((phy_loop+1) << 2) == 0x7C) {
                        /* Skip mode set done */
                        continue;
                }
                hdmi_reg_write(dev, phy_regs[phy_loop], HDMIDP_PHYREG((phy_loop+1) << 2));
        }

        hdmi_reg_write(dev, 0x90, HDMIDP_PHYREG(0x8C));

        tcc_hdmi_phy_mode_set_done(dev, 1);

        tcc_hdmi_phy_dump(dev);

	mdelay(16);

	phy_status = hdmi_reg_read(dev, HDMI_SS_PHY_STATUS_0) & 0xFF;
	if (!phy_status) {
                printk(KERN_ERR "[ERROR][HDMI_V14]%s HDMI PHY is not ready!!!\n", __func__);
        }
        else {
                printk(KERN_INFO "[INFO][HDMI_V14]%s HDMI PHY is ready!!\n", __func__);
        }

        ret = 0;

end_process:
        return ret;
}

